aggregate(x = (dflong_test$predmod0 - dflong_test$Solicitudes), by = list(dflong_test$Colegio), function = mean)
?aggregate
aggregate(x = dflong_test$predmod0 - dflong_test$Solicitudes, by = list(dflong_test$Colegio), FUN = "mean")
dflong_test$diffs <- (dflong_test$predmod0 - dflong_test$Solicitudes)**2
mean((dflong_test$pred_mod0 - dflong_test$Solicitudes) ** 2)
(dflong_test$pred_mod0 - dflong_test$Solicitudes) ** 2
dflong_test$diffs <- (dflong_test$pred_mod0 - dflong_test$Solicitudes) ** 2
aggregate(x = (dflong_test$pred_mod0 - dflong_test$Solicitudes), by = list(dflong_test$Colegio), function = mean)
aggregate(x = dflong_test$pred_mod0 - dflong_test$Solicitudes, by = list(dflong_test$Colegio), FUN = mean)
aggregate(x = (dflong_test$pred_mod0 - dflong_test$Solicitudes)**2, by = list(dflong_test$Colegio), FUN = mean)
aggregate((dflong_test$pred_mod0 - dflong_test$Solicitudes)**2, by = list(dflong_test$Colegio), FUN = mean)
aggregate((dflong_test$pred_mod0 - dflong_test$Solicitudes)**2, list(dflong_test$Colegio), mean)
dflong_test$diff <- (dflong_test$pred_mod0 - dflong_test$Solicitudes) ** 2
View(dflong_test)
mean(dflong_test$diff)
mean((dflong_test$pred_mod0 - dflong_test$Solicitudes) ** 2)
dflong_test$diff <- NA
View(dflong_test)
dflong_test$diff <- NULL
View(dflong_test)
(22.5 - 18)**2
sqrt((22.5 - 18)**2)
aggregate((dflong_test$pred_mod0 - dflong_test$Solicitudes)**2, list(dflong_test$Barrio), mean)
rm(list = ls())
mean((predict(mod0, dslong_test, allow.new.levels = TRUE) - dslong_test$Solicitudes) ** 2)
mean((predict(mod0, dslong_test, type = "response", allow.new.levels = TRUE) - dslong_test$Solicitudes) ** 2)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NA, rep("NULL", 8), rep(NA, 16)))
View(dataschools)
dataschools <- dataschools[complete.cases(dataschools[,3:12]),]
dataschools$Solicitudes_2017.2018 = NA
dataschools$Admisiones_2017.2018 = NA
dataschools <- dataschools[, c(1, 2, 4, 6, 8, 10, 12, 19, 3, 5, 7, 9, 11, 20, 13:18)]
colnames(dataschools) <- gsub("\\..*","", colnames(dataschools))
dslong <- reshape(dataschools, varying = 3:20, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
summary(dslong_no2017$Solicitudes)
hist(dslong_no2017$Solicitudes)
library(e1071)
skewness(dslong_no2017$Solicitudes, na.rm = TRUE)
skewness(dslong_no2017$Solicitudes)
library(boot)
booter <- boot(dslong_no2017$Solicitudes, function(x,i) skewness(x[i]),
R = 2000)
boot.ci(booter)
hist(log(dslong_no2017$Solicitudes + 2))
plot(density(log(dslong_no2017$Solicitudes) + 2))
skewness(log(dslong_no2017$Solicitudes + 2))
booter <- boot(log(dslong_no2017$Solicitudes + 2),
function(x,i) skewness(x[i]),
R = 2000)
boot.ci(booter)
library(car)
qqPlot(log(dslong_no2017$Solicitudes + 2))
shapiro.test(log(dslong_no2017$Solicitudes + 2))
dslong_train <- subset(dslong_no2017, Curso < 2016)
dslong_test <- subset(dslong_no2017, Curso == 2016)
mod0 <- lm(Solicitudes ~ Colegio, data = dslong_train)
mod0log <- lm(log(Solicitudes + 2) ~ Colegio, data = dslong_train)
mean((predict(mod0, dslong_test) - dslong_test$Solicitudes) ** 2)
mean(((exp(predict(mod0log, dslong_test)) - 2) - dslong_test$Solicitudes)**2)
mod1 <- lm(Solicitudes ~ Colegio + Curso, data = dflong_train)
mod1 <- lm(Solicitudes ~ Colegio + Curso, data = dslong_train)
mod1log <- lm(log(Solicitudes + 2) ~ Colegio + Curso, data = dslong_train)
mod1$coefficients
mod1 <- lm(Solicitudes ~ Colegio + scale(Curso), data = dslong_train)
mod1$coefficients
mod1$coefficients[247]
mod1$coefficients[240]
mod1$coefficients[[240]]
dim(mod1$coefficients)
names(mod1$coefficients)
mod1$coefficients[225]
mod1b$coefficients[225]
mod1 <- lm(Solicitudes ~ Colegio + Curso, data = dslong_train)
mod1b$coefficients[225]
mod1$coefficients[225]
mod1 <- lm(Solicitudes ~ Colegio + Curso, data = dslong_train)
mean((predict(mod1, dflong_test) - dflong_test$Solicitudes) ** 2)
mean((predict(mod1, dslong_test) - dslong_test$Solicitudes) ** 2)
mod1 <- lm(Solicitudes ~ Colegio + scale(Curso), data = dslong_train)
mean((predict(mod1, dslong_test) - dslong_test$Solicitudes) ** 2)
savehistory("~/.Rhistory")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NA, rep("NULL", 8), rep(NA, 16)))
setwd("~/Master_Data_Science/TFM")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NA, rep("NULL", 8), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NULL, NA, rep(NULL, 8), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NULL, NA, rep(NULL, 8), rep(NA, 16)))
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, "NULL", NA, rep("NULL", 8), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NULL, NA, rep("NULL", 7), rep(NA, 16)))
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NULL, NA, rep(NULL, 7), rep(NA, 16)))
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, NULL, NA, rep("NULL", 7), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, "NULL", NA, rep("NULL", 7), rep(NA, 16)))
View(dataschools)
setwd("~/Master_Data_Science/TFM")
dataschools <- read.csv("../3_Data_Munging/csv_files/DataSchools.csv",
colClasses=c(NA, "NULL", NA, rep("NULL", 7), rep(NA, 16)))
dataschools <- read.csv("../3_Data_Munging/csv_files/DataSchools.csv", colClasses=c(NA, "NULL", NA, rep("NULL", 7), rep(NA, 16)))
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv", colClasses=c(NA, "NULL", NA, rep("NULL", 7), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
View(dataschools)
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv", colClasses=c(NA, "NULL", rep(NA, 3), rep("NULL", 5), rep(NA, 16)))
View(dataschools)
dataschools <- read.csv("../3_Data_Munging/csv_files/DataSchools.csv")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
View(dataschools)
colnames(dataschools)
dscompletes <- dataschools[complete.cases(dataschools[,11:20]),]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
View(dscompletes)
colnames(dataschools)
colnames(dscompletes)
dscompletes <- dscompletes[, c(1:10, 12, 11, 14, 13, 16, 15, 18, 17, 20, 19,
27, 28, 21:26)]
View(dscompletes)
colnames(dataschools)
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
View(dscompletes)
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
colnames(dscompletes)
dscompletes <- dscompletes[, c(1, 3, 2, 5, 4, 7, 6, 9, 8, 11, 10, 18, 19,
12:17)]
View(dscompletes)
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
View(dslong_2017)
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
colnames(dscompletes)
dscompletes <- dscompletes[, c(1:11, 19, 18, 12:17)]
colnames(dscompletes)
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
View(dslong)
dataschools <- read.csv("../3_Data_Munging/csv_files/DataSchools.csv")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
dscompletes <- dscompletes[, c(1:11, 19, 18, 12:17)]
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
summary(dslong_no2017$Solicitudes)
library(lme4)
adm_model <- lmer(log(Solicitudes + 2) ~ Colegio
+ (1 + scale(Curso) | Colegio),
data = dslong_no2017)
dslong_2017$Solicitudes <- exp(predict(adm_model, dslong_2017)) - 2
sol_model <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso),
data = dslong_no2017)
dslong_2017$Admisiones <- exp(predict(sol_model, dslong_2017)) - 2
dslong_2017$Admisiones[dslong_2017$Admisiones < 0] <- 0
dslong_2017 <- dslong_2017[, c(1,3,4)]
View(dslong_2017)
colnames(dslong_2017) <- c("Colegio", "Solicitudes_2017.2018",
"Admisiones_2017.2018")
View(dslong_2017)
dataschools <- merge(dataschools, dslong_2017, by = "Colegio", all = TRUE)
View(dataschools)
colnames(dataschools)
View(dataschools)
View(dscompletes)
dataschools <- read.csv("../3_Data_Munging/csv_files/DataSchools.csv")
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
dscompletes <- dscompletes[, c(1:11, 19, 18, 12:17)]
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
dslong_train <- subset(dslong_no2017, Curso < 2016)
dslong_test <- subset(dslong_no2017, Curso == 2016)
View(dslong_train)
dslong_2017[dslong_2017$Admisiones > dslong_2017$Solicitudes,]
dslong_2017[dslong_2017$Admisiones > dslong_2017$Solicitudes,1]
dslong_2017[dslong_2017$Admisiones < dslong_2017$Solicitudes,1]
dslong_2017[(dslong_2017$Admisiones < dslong_2017$Solicitudes),1]
dslong_2017$Admisiones > dslong_2017$Solicitudes
View(dslong_2017)
dslong[dslong$Admisiones < dslong$Solicitudes, 1]
dslong[dslong$Admisiones > dslong$Solicitudes, 1]
dslong_no2017[dslong_no2017$Admisiones > dslong_no2017$Solicitudes, 1]
dslong_no2017$Colegio[dslong_no2017$Admisiones > dslong_no2017$Solicitudes]
length(dslong_no2017$Colegio[dslong_no2017$Admisiones > dslong_no2017$Solicitudes])
sol_model <- lmer(log(Solicitudes + 2) ~ Colegio
+ (1 + scale(Curso) | Colegio),
data = dslong_no2017)
adm_model <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso),
data = dslong_no2017)
dslong_2017$Admisiones <- exp(predict(adm_model, dslong_2017)) - 2
dslong_2017$Admisiones[dslong_2017$Admisiones < 0] <- 0
dslong_2017 <- dslong_2017[, c(1,3,4)]
colnames(dslong_2017) <- c("Colegio", "Admisiones_2017.2018",
"Solicitudes_2017.2018")
dataschools <- merge(dataschools, dslong_2017, by = "Colegio", all = TRUE)
write.csv(dataschools, file = "../4_Data_Analysis/csv_files/DataSchools.csv",
row.names = FALSE)
write.csv(dataschools, file = "4_Data_Analysis/csv_files/DataSchools.csv",
row.names = FALSE)
View(dataschools)
colnames(dataschools)
prueba <- dataschools[,c(1, 12, 14, 16, 18, 20, 28, 11, 13, 15, 17, 19, 27, 21:26)]
View(prueba)
View(dataschools)
rm(list = ls())
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
dscompletes <- dscompletes[, c(1:11, 19, 18, 12:17)]
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
length(dslong_no2017$Colegio[dslong_no2017$Admisiones >
dslong_no2017$Solicitudes])
summary(dslong_no2017$Solicitudes)
hist(dslong_no2017$Solicitudes)
dslong_train <- subset(dslong_no2017, Curso < 2016)
dslong_test <- subset(dslong_no2017, Curso == 2016)
library(lme4)
sol_model <- lmer(log(Solicitudes + 2) ~ Colegio
+ (1 + scale(Curso) | Colegio),
data = dslong_no2017)
dslong_2017$Solicitudes <- exp(predict(sol_model, dslong_2017)) - 2
adm_model <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso),
data = dslong_no2017)
dslong_2017$Admisiones <- exp(predict(adm_model, dslong_2017)) - 2
View(dslong_2017)
dslong_2017$Admisiones[dslong_2017$Admisiones < 0] <- 0
dslong_2017 <- dslong_2017[, c(1,3,4)]
View(dslong_2017)
colnames(dslong_2017) <- c("Colegio", "Admisiones_2017.2018",
"Solicitudes_2017.2018")
View(dslong_2017)
dataschools <- merge(dataschools, dslong_2017, by = "Colegio", all = TRUE)
View(dataschools)
colnames(dataschools)
prueba <- dataschools[,c(1, 12, 14, 16, 18, 20, 28, 11, 13, 15, 17, 19, 27, 21:26)]
View(prueba)
adm0 <- lm(Admisiones ~ Colegio, data = dslong_train)
adm0log <- lm(log(Admisiones + 2) ~ Colegio, data = dslong_train)
cat("model0 MSE: ", mean((predict(adm0, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model0log MSE: ", mean(((exp(predict(adm0log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm1 <- lm(Admisiones ~ Colegio + scale(Curso), data = dslong_train)
adm1log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso),
data = dslong_train)
cat("model1 MSE: ", mean((predict(adm1, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model1log MSE: ", mean(((exp(predict(adm1log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2 <- lmer(Admisiones ~ Colegio + (1 + scale(Curso) | Colegio),
data = dslong_train)
adm2log <- lmer(log(Admisiones + 2) ~ Colegio + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model2 MSE: ", mean((predict(adm2, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3 <- lm(Admisiones ~ Colegio + Solicitudes + scale(Curso), data = dslong_train)
adm3log <- lm(log(Admisiones + 2) ~ Colegio + Solicitudes + scale(Curso), data = dslong_train)
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3loglog <- lm(log(Admisiones + 2) ~ Colegio + log(Solicitudes + 2) + scale(Curso), data = dslong_train)
cat("model3loglog MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
cat("model3loglog MSE: ", mean(((exp(predict(adm3loglog, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm4loglog <- lmer(log(Admisiones + 2) ~ Colegio + log(Solicitudes + 2) + (1 + scale(Curso) | Colegio), data = dslong_train)
cat("model4loglog MSE: ", mean(((exp(predict(adm4loglog, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2 <- lm(Admisiones ~ Colegio + Solicitudes + scale(Curso), data = dslong_train)
adm2log <- lm(log(Admisiones + 2) ~ Colegio + log(Solicitudes + 2) + scale(Curso),
data = dslong_train)
cat("model2 MSE: ", mean((predict(adm2, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
summary(model2log)
summary(adm2log)
adm2log <- lm(log(Admisiones + 2) ~ Colegio:scale(Curso) + log(Solicitudes + 2), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso) + log(Solicitudes + 2), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso):log(Solicitudes + 2), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso) + log(Solicitudes + 2) + Colegio:scale(Curso), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso) + log(Solicitudes + 2) + Colegio*scale(Curso), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2log <- lm(log(Admisiones + 2) ~ log(Solicitudes + 2) + Colegio*scale(Curso), data = dslong_train)
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm2 <- lm(Admisiones ~ Colegio + Solicitudes + scale(Curso), data = dslong_train)
adm2log <- lm(log(Admisiones + 2) ~ Colegio + log(Solicitudes + 2) + scale(Curso),
data = dslong_train)
cat("model2 MSE: ", mean((predict(adm2, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3 <- lmer(Admisiones ~ Colegio + Solicitudes + (1 + scale(Curso) | Colegio),
data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + Solicitudes + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model3 MSE: ", mean((predict(adm2, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model3log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3 <- lmer(Admisiones ~ Colegio + Solicitudes + (1 + scale(Curso) | Colegio),
data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + log(Solicitudes + 2) + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3log <- lmer(log(Admisiones + 2) ~ log(Solicitudes + 2) + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3log <- lmer(log(Admisiones + 2) ~ (1 + log(Solicitudes + 2) | Colegio) + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3log <- lmer(log(Admisiones + 2) ~ (1 + log(Solicitudes + 2) | scale(Curso)) + (1 + scale(Curso) | Colegio),
data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + (1 + log(Solicitudes + 2) | Colegio/scale(Curso)),
data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + (1 + log(Solicitudes + 2) | Colegio),
data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) + log(Solicitudes + 2) + (1 + log(Solicitudes + 2) | Colegio),
data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) + log(Solicitudes + 2) + (1 + log(Solicitudes + 2) | Colegio) + (1 + scale(Curso) | Colegio),
data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3 <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio) +
(1 + Solicitudes | Colegio), data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + log(Solicitudes + 2) | Colegio) +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3 <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio) +
(1 + Solicitudes | scale(Curso)), data = dslong_train)
adm3 <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
cat("model2 MSE: ", mean((predict(adm2, dslong_test) -
dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) -
dslong_test$Admisiones)**2))
adm4log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + log(Solicitudes + 2) | Colegio) +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model4log MSE: ", mean(((exp(predict(adm4log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3b <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio), data = dslong_train, REML = FALSE)
adm3blog <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_train,
REML = FALSE)
adm4blog <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + log(Solicitudes + 2) | Colegio) +
(1 + scale(Curso) | Colegio), data = dslong_train,
REML = FALSE)
cat("model4blog MSE: ", mean(((exp(predict(adm4blog, dslong_test)) - 2) - dslong_test$Admisiones)**2))
AIC(adm0, adm1, adm2, adm3b)
adm0 <- lm(Admisiones ~ Colegio, data = dslong_train)
adm0log <- lm(log(Admisiones + 2) ~ Colegio, data = dslong_train)
cat("model0 MSE: ", mean((predict(adm0, dslong_test) -
dslong_test$Admisiones) ** 2))
cat("model0log MSE: ", mean(((exp(predict(adm0log, dslong_test)) - 2) -
dslong_test$Admisiones)**2))
adm1 <- lm(Admisiones ~ Colegio + scale(Curso), data = dslong_train)
adm1log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso),
data = dslong_train)
cat("model1 MSE: ", mean((predict(adm1, dslong_test) -
dslong_test$Admisiones) ** 2))
cat("model1log MSE: ", mean(((exp(predict(adm1log, dslong_test)) - 2) -
dslong_test$Admisiones)**2))
adm2 <- lm(Admisiones ~ Colegio + scale(Curso) + Solicitudes,
data = dslong_train)
adm2log <- lm(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2), data = dslong_train)
cat("model2 MSE: ", mean((predict(adm2, dslong_test) -
dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) -
dslong_test$Admisiones)**2))
adm3 <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio), data = dslong_train)
adm3log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm4log <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + log(Solicitudes + 2) | Colegio) +
(1 + scale(Curso) | Colegio), data = dslong_train)
cat("model4log MSE: ", mean(((exp(predict(adm4log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
adm3b <- lmer(Admisiones ~ Colegio + scale(Curso) + Solicitudes +
(1 + scale(Curso) | Colegio), data = dslong_train, REML = FALSE)
adm3blog <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_train,
REML = FALSE)
adm4blog <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + log(Solicitudes + 2) | Colegio) +
(1 + scale(Curso) | Colegio), data = dslong_train,
REML = FALSE)
AIC(adm0, adm1, adm2, adm3b)
cbind(AIC(adm0log, adm1log, adm2log, adm3blog)[,1, drop = FALSE],
AIC = c(AIC(adm0log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm1log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm2log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm3blog) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm4blog) + 2 * sum(log(dslong_train$Admisiones + 2))))
cbind(AIC(adm0log, adm1log, adm2log, adm3blog, adm4blog)[,1, drop = FALSE],
AIC = c(AIC(adm0log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm1log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm2log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm3blog) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm4blog) + 2 * sum(log(dslong_train$Admisiones + 2))))
cat("model3log MSE: ", mean(((exp(predict(adm3log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
cat("model3 MSE: ", mean((predict(adm3, dslong_test) - dslong_test$Admisiones) ** 2))
cat("model2log MSE: ", mean(((exp(predict(adm2log, dslong_test)) - 2) -
dslong_test$Admisiones)**2))
adm2 <- lm(Admisiones ~ Colegio + scale(Curso) + Solicitudes,
data = dslong_train)
cat("model2 MSE: ", mean((predict(adm2, dslong_test) -
dslong_test$Admisiones) ** 2))
cat("model4log MSE: ", mean(((exp(predict(adm4log, dslong_test)) - 2) - dslong_test$Admisiones)**2))
cbind(AIC(adm0log, adm1log, adm2log, adm3blog, adm4blog)[,1, drop = FALSE],
AIC = c(AIC(adm0log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm1log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm2log) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm3blog) + 2 * sum(log(dslong_train$Admisiones + 2)),
AIC(adm4blog) + 2 * sum(log(dslong_train$Admisiones + 2))))
sol_model <- lmer(log(Solicitudes + 2) ~ Colegio
+ (1 + scale(Curso) | Colegio),
data = dslong_no2017)
dslong_2017$Solicitudes <- exp(predict(sol_model, dslong_2017)) - 2
View(dslong_2017)
rm(list = ls())
dataschools <- read.csv("3_Data_Munging/csv_files/DataSchools.csv")
dscompletes <- dataschools[complete.cases(dataschools[,11:20]), c(1, 11:26)]
dscompletes$Solicitudes_2017.2018 = NA
dscompletes$Admisiones_2017.2018 = NA
dscompletes <- dscompletes[, c(1:11, 19, 18, 12:17)]
colnames(dscompletes) <- gsub("\\..*","", colnames(dscompletes))
dslong <- reshape(dscompletes, varying = 2:19, sep = "_",
timevar = "Curso", direction = "long")
dslong_2017 <- subset(dslong, Curso == 2017)
dslong_no2017 <- subset(dslong, Curso != 2017)
length(dslong_no2017$Colegio[dslong_no2017$Admisiones >
dslong_no2017$Solicitudes])
sol_model <- lmer(log(Solicitudes + 2) ~ Colegio
+ (1 + scale(Curso) | Colegio),
data = dslong_no2017)
dslong_2017$Solicitudes <- exp(predict(sol_model, dslong_2017)) - 2
adm_model <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_train)
adm_model <- lmer(log(Admisiones + 2) ~ Colegio + scale(Curso) +
log(Solicitudes + 2) +
(1 + scale(Curso) | Colegio), data = dslong_no2017)
dslong_2017$Admisiones <- exp(predict(adm_model, dslong_2017)) - 2
dslong_2017$Admisiones[dslong_2017$Admisiones < 0] <- 0
dslong_2017 <- dslong_2017[, c(1,3,4)]
colnames(dslong_2017) <- c("Colegio", "Admisiones_2017.2018",
"Solicitudes_2017.2018")
dataschools <- merge(dataschools, dslong_2017, by = "Colegio", all = TRUE)
prueba <- dataschools[,c(1, 12, 14, 16, 18, 20, 28, 11, 13, 15, 17, 19, 27, 21:26)]
View(prueba)
prueba$admissions2012_p <- round(prueba$Admisiones_2012.2013/prueba$Solicitudes_2012.2013, 2)
prueba$admissions2013_p <- round(prueba$Admisiones_2013.2014/prueba$Solicitudes_2013.2014, 2)
prueba$admissions2014_p <- round(prueba$Admisiones_2014.2015/prueba$Solicitudes_2014.2015, 2)
prueba$admissions2015_p <- round(prueba$Admisiones_2015.2016/prueba$Solicitudes_2015.2016, 2)
prueba$admissions2016_p <- round(prueba$Admisiones_2016.2017/prueba$Solicitudes_2016.2017, 2)
prueba$admissions2017_p <- round(prueba$Admisiones_2017.2018/prueba$Solicitudes_2017.2018, 2)
View(prueba)
prueba$admissions2017_p <- round((prueba$Admisiones_2017.2018/prueba$Solicitudes_2017.2018)*100, 2)
prueba$admissions2016_p <- round((prueba$Admisiones_2016.2017/prueba$Solicitudes_2016.2017)*100, 2)
prueba$admissions2015_p <- round((prueba$Admisiones_2015.2016/prueba$Solicitudes_2015.2016)*100, 2)
prueba$admissions2014_p <- round((prueba$Admisiones_2014.2015/prueba$Solicitudes_2014.2015)*100, 2)
prueba$admissions2013_p <- round((prueba$Admisiones_2013.2014/prueba$Solicitudes_2013.2014)*100, 2)
prueba$admissions2012_p <- round((prueba$Admisiones_2012.2013/prueba$Solicitudes_2012.2013)*100, 2)
